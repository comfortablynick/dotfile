# vim:ft=yaml.ansible:
---
- name: File tests
  hosts: all
  tasks:
    - name: Find out age of mirrorlist
      find:
        paths: /etc/pacman.d
        age: "{{ file_age }}"
        age_stamp: mtime
      register: found
      when: "ansible_facts['os_family'] == 'Archlinux'"
    - debug:
        msg: "Files older than {{ file_age }} found: {{ found }}"
        verbosity: 2
    - debug:
        msg:
          - "Path: {{ item['path'] }}"
          - "File: {{ item['path'] | basename }}"
          - "Date: {{ '%Y-%m-%d %H:%M:%S' | strftime(item['mtime']) }}"
      loop: "{{ found['files'] | default([]) }}"
      loop_control:
        label: "{{ item['path'] }}"
  vars:
    file_age: "1m"

# - name: Link test
#   hosts: mars
#   roles:
#     - dotfiles
