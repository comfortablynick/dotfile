#!/usr/bin/env bash
# Print weather from wttr.in
# TODO: use ipinfo to get location from ip

# Formats:
#       ?format=1       One line output of temp
#       ?format=2       One line output of temp/wind
#       ?format=3       Same as 1 with loc
#       ?format=4       Same as 2 with loc

get_loc() {
    if [[ -n $1 ]]; then
        loc=$1
    else
        local host
        host=$(hostname)
        [[ $host == jupiter ]] && loc=76207 || loc=75067
    fi
}

get_fmt() {
    [[ -n $1 ]] && fmtstr="?format=$1"
}

main() {
    local loc fmtstr url weather
    get_loc "$1"
    get_fmt "$2"
    url="wttr.in/$loc$fmtstr"
    echo "$url"
    weather=$(curl -s "$url")

    if [[ -n $fmtstr ]]; then
        # Remove space and positive temp sign "+" in one-line output
        echo "${weather/ +/}"
    else
        echo "$weather"
    fi
}

main "$@"
