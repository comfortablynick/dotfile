#!/bin/sh

# NOTE: Use system package if possible
# Wrapper script to make lua-language-server easier to run
DIR="$HOME/src/lua-language-server"

run() {
    OS="$(uname -s | sed s/Darwin/macOS/)"
    cd "$DIR" || exit 1
    "bin/$OS/lua-language-server" -E -e LANG=en ./main.lua
}

update() {
    cd "$DIR" || exit 1
    git pull
    git submodule update --init --recursive

    cd 3rd/luamake || exit 1
    ninja -f ninja/linux.ninja
    cd ../..
    ./3rd/luamake/luamake rebuild
}

if [ "$1" = "update" ]; then
    echo "Updating lua-language-server"
    update
elif command -v lua-language-server >/dev/null 2>&1; then
    lua-language-server "$@"
else
    run
fi
