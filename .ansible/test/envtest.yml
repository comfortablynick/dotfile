---
# vim:ft=yaml.ansible:
- name: Test environment variables
  hosts: all
  tasks:
    - name: Debug env output
      debug:
        msg: |
          Output from lookup('env', 'HOME') = {{ lookup('env', 'HOME') }}
          Output from ansible_facts['env']['HOME'] = {{ ansible_facts['env']['HOME'] }}
          Output from ansible_facts.user_dir = {{ ansible_facts.user_dir }}
    - name: Print ansible_facts
      debug:
        var: ansible_facts
        verbosity: 1


- name: Set vars
  hosts: all
  vars:
    path:
      - $HOME/bin
      - $HOME/.local/bin
      - $HOME/.cargo/bin
      - $HOME/go/bin
      - $HOME/noexist
    env:
      FZF_DEFAULT_OPTS: "\"--ansi --border --reverse --height='$FZF_TMUX_HEIGHT'\""
      NVIM_PY3_DIR: "{{ '$HOME/.env/nvim3'|if_is_dir() }}"
      NOEXIST: ""
    alias:
      gs: git status
      g: git
      vid: $HOME/.config/nvim
      e: eval $FZY_DEFAULT_COMMAND | fzy | xargs -r $EDITOR $file
    bash_env:
      PATH: >-
        $(echo -n $PATH | awk -v RS=: -v ORS=: '!x[$0]++' | sed "s/\(.*\).\{1\}/\1/")
  tasks:
    - name: Debug path vars
      debug:
        var: path

    - name: Debug env vars
      debug:
        var: env

    - name: Create posix file from template
      template:
        dest: ~/.ansible/test/out/env.sh
        src: ~/.ansible/test/posix.j2

    - name: Create fish file from template
      template:
        dest: ~/.ansible/test/out/env.fish
        src: ~/.ansible/test/fish.j2
